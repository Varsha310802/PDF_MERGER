-- Step 1: Create the Orders Database
CREATE DATABASE Orders;
GO

USE Orders;
GO

-- Step 2: Create tblCustomers Table
CREATE TABLE tblCustomers (
    CustomerID INT PRIMARY KEY,
    CompanyName NVARCHAR(255) NOT NULL,
    City NVARCHAR(255),
    Country NVARCHAR(100) DEFAULT 'Canada'
);

-- Step 3: Create tblShippers Table
CREATE TABLE tblShippers (
    ShipperID INT PRIMARY KEY,
    CompanyName NVARCHAR(255) NOT NULL UNIQUE,
    Discount DECIMAL(5,2)
);

-- Step 4: Create tblProducts Table
CREATE TABLE tblProducts (
    ProductID INT PRIMARY KEY,
    CategoryID INT,
    ProductName NVARCHAR(255) NOT NULL,
    UnitPrice DECIMAL(10, 2)
);

-- Step 5: Create tblOrders Table
CREATE TABLE tblOrders (
    OrderID INT PRIMARY KEY,
    CustomerID INT,
    EmployeeID INT,
    OrderDate DATE NOT NULL,
    ShippedDate DATE,
    CONSTRAINT fk_CustomerID FOREIGN KEY (CustomerID) REFERENCES tblCustomers(CustomerID),
    CONSTRAINT chk_ShippedDate CHECK (ShippedDate > OrderDate)
);

-- Step 6: Create tblOrderDetails Table
CREATE TABLE tblOrderDetails (
    OrderID INT,
    ProductID INT,
    UnitPrice DECIMAL(10, 2),
    Quantity INT CHECK (Quantity > 10),
    PRIMARY KEY (OrderID, ProductID),
    CONSTRAINT fk_OrderID FOREIGN KEY (OrderID) REFERENCES tblOrders(OrderID),
    CONSTRAINT fk_ProductID FOREIGN KEY (ProductID) REFERENCES tblProducts(ProductID)
);

-- Step 7: Insert Data into tblCustomers
INSERT INTO tblCustomers (CustomerID, CompanyName, City)
VALUES 
(1, 'Acme Corporation', 'Toronto'),
(2, 'Global Tech', 'Vancouver'),
(3, 'Blue Sky Ltd.', 'Montreal');

-- Step 8: Insert Data into tblShippers
INSERT INTO tblShippers (ShipperID, CompanyName, Discount)
VALUES 
(1, 'FastTrack Shipping', 10.50),
(2, 'Global Delivery', 5.00),
(3, 'Express Logistics', 7.25);

-- Step 9: Insert Data into tblProducts
INSERT INTO tblProducts (ProductID, CategoryID, ProductName, UnitPrice)
VALUES 
(1, 101, 'Laptop', 1500.00),
(2, 102, 'Smartphone', 800.00),
(3, 103, 'Tablet', 500.00);

-- Step 10: Insert Data into tblOrders
INSERT INTO tblOrders (OrderID, CustomerID, EmployeeID, OrderDate, ShippedDate)
VALUES 
(1, 1, 1001, '2024-09-01', '2024-09-03'),
(2, 2, 1002, '2024-09-02', '2024-09-05'),
(3, 3, 1003, '2024-09-04', '2024-09-06');

-- Step 11: Insert Data into tblOrderDetails
INSERT INTO tblOrderDetails (OrderID, ProductID, UnitPrice, Quantity)
VALUES 
(1, 1, 1500.00, 12),
(1, 2, 800.00, 15),
(2, 3, 500.00, 11),
(3, 1, 1500.00, 13);

-- Violations:

-- Quantity < 10 violation in tblOrderDetails (Constraint: Quantity > 10)
INSERT INTO tblOrderDetails (OrderID, ProductID, UnitPrice, Quantity)
VALUES (4, 2, 800.00, 8);  -- This will fail

-- Duplicate CompanyName violation in tblShippers (Constraint: UNIQUE)
INSERT INTO tblShippers (ShipperID, CompanyName, Discount)
VALUES (4, 'FastTrack Shipping', 8.75);  -- This will fail

-- ShippedDate < OrderDate violation in tblOrders (Constraint: ShippedDate > OrderDate)
INSERT INTO tblOrders (OrderID, CustomerID, EmployeeID, OrderDate, ShippedDate)
VALUES (4, 1, 1001, '2024-09-10', '2024-09-08');  -- This will fail
